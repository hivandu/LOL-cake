!function(lib){function ZipFile(){}var p=ZipFile.prototype;p.init=function(){this._isComprsize=false;this.mask=null;this._nativePath="";this.uncomprsize=0;this.comprsize=0;this.offset=0;this.bufferSize=0;this.buffer=null;this._type="";this._size=0;this._name="";this._path="";this.data=null};p.__defineSetter__("nativePath",function(value){this._nativePath=value;var arr=value.split("/");this._name=arr[arr.length-1];this._path=arr.join("/");var type=this._name.split(".");this._type=type[type.length-1]});p.__defineGetter__("nativePath",function(){return this._nativePath});p.__defineGetter__("type",function(){return this._type});p.__defineGetter__("name",function(){return this._name});p.__defineGetter__("path",function(){return this._path});p.__defineGetter__("size",function(){return this.isComprsize?this.uncomprsize:this.comprsize});p.__defineSetter__("isComprsize",function(value){this._isComprsize=value});p.__defineGetter__("isComprsize",function(){return this._isComprsize});lib.ZipFile=ZipFile}(window);
!function(lib){var createBlob=function(data,mimeType){var blob;try{blob=new Blob([data],{type:mimeType})}catch(e){if(e.name=="TypeError"&&BlobBuilder){var bb=new BlobBuilder();if(typeof data=="string"){var arr=data}else{if(data instanceof ArrayBuffer){data=new DataView(data)}var arr=data.buffer}bb.append(arr);blob=bb.getBlob(mimeType)}}return blob};window.createBlob=createBlob;window.URL=window.URL||window.webkitURL;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(ArrayBuffer.prototype.slice===undefined){ArrayBuffer.prototype.slice=function(start,end){var that=new Uint8Array(this);if(end==undefined){end=that.length}var result=new ArrayBuffer(end-start);var resultArray=new Uint8Array(result);for(var i=0;i<resultArray.length;i++){resultArray[i]=that[i+start]}return result}}var byteToString=function(data,offset,length){offset=offset===undefined?0:offset;length=length===undefined?data.byteLength:length;var utf8=new Uint8Array(data,offset,length);var str=String.fromCharCode.apply(null,utf8);return str};var FILE_HEAD=67324752;var WORKER_TXT='this.TGFileSystem=this.TGFileSystem||{};!function(){var n=32768;var b=0,f=1;var m=32768;var o=258;var c=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);var g=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]);var h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]);var i=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);var j=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);function d(s){var q=s.length;var t=0;var p=Number.POSITIVE_INFINITY;var D;var B;var x;var r;var A;var w;var C;var v;var y;var u;var z;for(v=0,y=q;v<y;++v){if(s[v]>t){t=s[v]}if(s[v]<p){p=s[v]}}D=1<<t;B=new Uint32Array(D);for(x=1,r=0,A=2;x<=t;){for(v=0;v<q;++v){if(s[v]===x){for(w=0,C=r,u=0;u<x;++u){w=(w<<1)|(C&1);C>>=1}z=(x<<16)|v;for(u=w;u<D;u+=A){B[u]=z}++r}}++x;r<<=1;A<<=1}return[B,t,p]}var l=(function(p){return p})((function(){var r=new Uint8Array(288);var q,p;for(q=0,p=r.length;q<p;++q){r[q]=(q<=143)?8:(q<=255)?9:(q<=279)?7:8}return d(r)})());var k=(function(p){return p})((function(){var r=new Uint8Array(30);var q,p;for(q=0,p=r.length;q<p;++q){r[q]=5}return d(r)})());function a(p,q){this.blocks=[];this.bufferSize=n;this.totalpos=0;this.ip=0;this.bitsbuf=0;this.bitsbuflen=0;this.input=new Uint8Array(p);this.output;this.op;this.bfinal=false;this.bufferType=f;this.resize=false;this.prev;if(q||!(q={})){if(q.index){this.ip=q.index}if(q.bufferSize){this.bufferSize=q.bufferSize}if(q.bufferType){this.bufferType=q.bufferType}if(q.resize){this.resize=q.resize}}switch(this.bufferType){case b:this.op=m;this.output=new Uint8Array(m+this.bufferSize+o);break;case f:this.op=0;this.output=new Uint8Array(this.bufferSize);this.expandBuffer=this.expandBufferAdaptive;this.concatBuffer=this.concatBufferDynamic;this.decodeHuffman=this.decodeHuffmanAdaptive;break;default:throw new Error("invalid inflate mode")}}var e=a.prototype;e.concatBufferDynamic=function(){var p;var q=this.op;if(this.resize){p=new Uint8Array(q);p.set(this.output.subarray(0,q))}else{p=this.output.subarray(0,q)}this.buffer=p;return this.buffer};e.decodeHuffmanAdaptive=function(s,w){var r=this.output;var v=this.op;this.currentLitlenTable=s;var u=r.length;var q;var p;var t;var x;while((q=this.readCodeByTable(s))!==256){if(q<256){if(v>=u){r=this.expandBuffer();u=r.length}r[v++]=q;continue}p=q-257;x=g[p];if(h[p]>0){x+=this.readBits(h[p])}q=this.readCodeByTable(w);t=i[q];if(j[q]>0){t+=this.readBits(j[q])}if(v+x>u){r=this.expandBuffer();u=r.length}while(x--){r[v]=r[(v++)-t]}}while(this.bitsbuflen>=8){this.bitsbuflen-=8;this.ip--}this.op=v};e.readCodeByTable=function(y){var r=this.bitsbuf;var p=this.bitsbuflen;var v=this.input;var u=this.ip;var s=v.length;var x=y[0];var q=y[1];var t;var w;while(p<q){if(u>=s){break}r|=v[u++]<<p;p+=8}t=x[r&((1<<q)-1)];w=t>>>16;this.bitsbuf=r>>w;this.bitsbuflen=p-w;this.ip=u;return t&65535};e.expandBufferAdaptive=function(u){var p;var v=(this.input.length/this.ip+1)|0;var t;var s;var w;var r=this.input;var q=this.output;if(u){if(typeof u.fixRatio==="number"){v=u.fixRatio}if(typeof u.addRatio==="number"){v+=u.addRatio}}if(v<2){t=(r.length-this.ip)/this.currentLitlenTable[2];w=(t/2*258)|0;s=w<q.length?q.length+w:q.length<<1}else{s=q.length*v}p=new Uint8Array(s);p.set(q);this.output=p;return this.output};e.parseUncompressedBlock=function(){var w=this.input;var v=this.ip;var p=this.output;var t=this.op;var r=w.length;var u;var x;var s=p.length;var q;this.bitsbuf=0;this.bitsbuflen=0;if(v+1>=r){throw new Error("invalid uncompressed block header: LEN")}u=w[v++]|(w[v++]<<8);if(v+1>=r){throw new Error("invalid uncompressed block header: NLEN")}x=w[v++]|(w[v++]<<8);if(u===~x){throw new Error("invalid uncompressed block header: length verify")}if(v+u>w.length){throw new Error("input buffer is broken")}switch(this.bufferType){case b:while(t+u>p.length){q=s-t;u-=q;p.set(w.subarray(v,v+q),t);t+=q;v+=q;this.op=t;p=this.expandBuffer();t=this.op}break;case f:while(t+u>p.length){p=this.expandBuffer({fixRatio:2})}break;default:throw new Error("invalid inflate mode")}p.set(w.subarray(v,v+u),t);t+=u;v+=u;this.ip=v;this.op=t;this.output=p};e.readBits=function(t){var v=this.bitsbuf;var s=this.bitsbuflen;var r=this.input;var u=this.ip;var q=r.length;var p;while(s<t){if(u>=q){throw new Error("input buffer is broken")}v|=r[u++]<<s;s+=8}p=v&((1<<t)-1);v>>>=t;s-=t;this.bitsbuf=v;this.bitsbuflen=s;this.ip=u;return p};e.parseBlock=function(){var p=this.readBits(3);if(p&1){this.bfinal=true}p>>>=1;switch(p){case 0:this.parseUncompressedBlock();break;case 1:this.parseFixedHuffmanBlock();break;case 2:this.parseDynamicHuffmanBlock();break;default:throw new Error("unknown BTYPE: "+p)}};e.parseDynamicHuffmanBlock=function(){var x=this.readBits(5)+257;var v=this.readBits(5)+1;var w=this.readBits(4)+4;var u=new Uint8Array(c.length);var s;var r;var t;var q;for(q=0;q<w;++q){u[c[q]]=this.readBits(3)}s=d(u);function p(y,C,E){var B;var A=this.prev;var D;var z;for(z=0;z<y;){B=this.readCodeByTable(C);switch(B){case 16:D=3+this.readBits(2);while(D--){E[z++]=A}break;case 17:D=3+this.readBits(3);while(D--){E[z++]=0}A=0;break;case 18:D=11+this.readBits(7);while(D--){E[z++]=0}A=0;break;default:E[z++]=B;A=B;break}}this.prev=A;return E}r=new Uint8Array(x);t=new Uint8Array(v);this.prev=0;this.decodeHuffman(d(p.call(this,x,s,r)),d(p.call(this,v,s,t)))};e.parseFixedHuffmanBlock=function(){this.decodeHuffman(l,k)};e.decompress=function(){while(!this.bfinal){this.parseBlock()}return this.concatBuffer()};TGFileSystem.RawInflate=a}();self.addEventListener("message",function(c){var a=c.data;var b=new TGFileSystem.RawInflate(a.data,{index:a.index,bufferSize:a.size,resize:true});a=b.decompress();self.postMessage(a)},false);';
var BLOB=null;function ZipPackage(){this.init()}var p=ZipPackage.prototype;p.init=function(){if(!BLOB){BLOB=URL.createObjectURL(createBlob(WORKER_TXT,"application/javascript"))}this._files=[]};p.parse=function(buffer){var data=new DataView(buffer);var _offset=0;var _files=this._files;while(data.getUint32(_offset,true)==FILE_HEAD){var zip=new lib.ZipFile();_offset+=6;var mask=data.getUint16(_offset,true)==1;_offset+=2;var isCompressed=data.getUint16(_offset,true)!=0;_offset+=10;var comprsize=data.getUint32(_offset,true);_offset+=4;var uncomprsize=data.getUint32(_offset,true);_offset+=4;var fls=data.getInt16(_offset,true);_offset+=2;var ext=data.getUint16(_offset,true);_offset+=2;zip.mask=mask;zip.isComprsize=isCompressed;zip.nativePath=byteToString(data.buffer,_offset,fls);_offset+=(fls+ext);var size=isCompressed?comprsize:uncomprsize;zip.comprsize=comprsize;zip.uncomprsize=uncomprsize;zip.offset=0;zip.bufferSize=size;var bf=data.buffer.slice(_offset,_offset+size);zip.buffer=bf;_offset+=size;if(mask){_offset+=12}if(size>0){_files.push(zip)}}buffer=null};var count=5;var wokerDecompress=function(value,callback){var self=this;if(value.length>0){var len=value.length;len=len>count?count:len;var temp=[];for(var i=0;i<len;i++){temp.push(i);var zip=value.shift();if(!zip.isComprsize){if(callback){callback({type:"fileload",file:zip})}temp.shift();if(temp.length==0){wokerDecompress.apply(self,[value,callback])}return}var worker=new Worker(BLOB);worker.zip=zip;worker.onmessage=function(e){temp.shift();this.zip.isComprsize=false;this.zip.buffer=e.data;this.zip.offset=0;this.zip.bufferSize=this.zip.buffer.length;this.terminate();if(callback){callback({type:"progress",progress:1-value.length/self._files.length})}if(callback){callback({type:"fileload",file:this.zip})}if(temp.length==0){wokerDecompress.apply(self,[value,callback])}};worker.onerror=function(e){temp.shift();if(callback){callback({type:"error",file:this.zip})}this.terminate();if(temp.length==0){wokerDecompress.apply(self,[value,callback])
}};worker.postMessage({data:zip.buffer,index:0,size:zip.buffer.byteLength})}}else{if(callback){callback({type:"complete",target:this})}}};p.getFile=function(path){for(var i=0;i<this._files.length;i++){if(this._files[i].nativePath==path){return this._files[i]}}return};p.getPath=function(path){var list=[];for(var i=0;i<this._files.length;i++){if(this._files[i].path==path){list.push(this._files[i])}}return list};p.__defineGetter__("files",function(){return this._files});p.decompress=function(callback){var tempList=this._files.concat();if(tempList.length==0){if(callback){callback({type:"complete",target:this})}}wokerDecompress.apply(this,[tempList,callback])};lib.ZipPackage=ZipPackage}(window);
